!function(e){var t={};function n(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/ywiki-plugins/dist/production/",n(n.s=48)}({47:function(e,t,n){"use strict";function o(){this._s1=[],this._s2=[]}e.exports=function(t){var n;function a(e,t){var a=new o;function r(t,o,r){if(e){e--;var s=new n(function(e){e(t.apply(o,r))});return s.then(i,i),s}return new n(function(e){a.push(new function(e,t,n,o){this.resolve=e,this.fn=t,this.self=n||null,this.args=o}(e,t,o,r))})}function i(){if(e++,!a.isEmpty()){var t=a.shift();t.resolve(r(t.fn,t.self,t.args))}}if("function"==typeof e){var s=t;t=e,e=s}if("number"!=typeof e)throw new TypeError("Expected throat size to be a number but got "+typeof e);if(void 0!==t&&"function"!=typeof t)throw new TypeError("Expected throat fn to be a function but got "+typeof t);return"function"==typeof t?function(){for(var e=[],n=0;n<arguments.length;n++)e.push(arguments[n]);return r(t,this,e)}:function(e){if("function"!=typeof e)throw new TypeError("Expected throat fn to be a function but got "+typeof e);for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);return r(e,this,t)}}if(1===arguments.length&&"function"==typeof t)return n=t,a;if("function"!=typeof(n=e.exports.Promise))throw new Error("You must provide a Promise polyfill for this library to work in older environments");return a(arguments[0],arguments[1])},"function"==typeof Promise&&(e.exports.Promise=Promise),o.prototype.push=function(e){this._s1.push(e)},o.prototype.shift=function(){var e=this._s2;if(0===e.length){var t=this._s1;if(0===t.length)return;this._s1=e,e=this._s2=t.reverse()}return e.pop()},o.prototype.isEmpty=function(){return!this._s1.length&&!this._s2.length}},48:function(e,t,n){const o=n(47)(3);async function a(e,t,n){var o="/pages/movepage.action?pageId="+encodeURIComponent(e)+"&spaceKey="+encodeURIComponent(t)+"&targetTitle="+encodeURIComponent(n)+"&position=append&atl_token="+$("meta[name=ajs-atl-token]").attr("content")+"&_="+Math.random();return console.log("Moving page ",e," under ",t+":"+n,o),await $.ajax(o)}async function r(e,t,n){var o="";n&&(o="&expand="+encodeURIComponent(n));var a="/rest/api/content?type=page&spaceKey="+encodeURIComponent(e)+"&limit=1&title="+encodeURIComponent(t)+o;console.log("Getting page content from "+a);var r=await $.ajax(a);if(console.log("Filtering AJAX response",r),r.results&&r.results.length>0){var i=r.results[0];return console.log("Returning ",i),i}throw"Page Not found: '"+e+":"+t+"'"}async function i(e,t){var n="";t&&(n="?expand="+encodeURIComponent(t));var o="/rest/api/content/"+encodeURIComponent(e)+n;return console.log(o),await $.ajax(o)}async function s(e,t,n,o,a){var r=await i(e,"space,body.storage,children.page,metadata.labels");if(o.isApplicableTemplatePage(r)){o.transformPage(r);var s=await p(r,t,n);return a.push(s),await c(r,t,s.id,o,a)}return console.log("Page is not a template, not copied, but children will be copied: ",r.title),await c(r,t,n,o,a)}async function c(e,t,n,o,a){var r=[];if(console.log("In copyAllChildren",e,n),e.children&&e.children.page&&e.children.page.results)for(let i of e.children.page.results)r.push(await s(i.id,t,n,o,a));return r}async function l(e,t,n){var o=await r(t,n,"space");return console.log("targetParentPage: space=",o.space.key,"id=",o.id,"title=",o.title),await p(e,o.space.key,o.id)}async function p(e,t,n){return e.ancestors=[{id:n}],console.log("New Page",e),e.space={key:t},await async function(e){return await $.ajax({url:"/rest/api/content",type:"POST",contentType:"application/json",data:JSON.stringify(e)})}(e)}async function u(e,t){var n=[["Title","Parent","Number of pages","Age"]],a=await r(e,t);await async function e(t,n,a){console.log(`Queueing getContentById for ${t}`);var r=await o(()=>i(t,"history.lastUpdated,children.page"));a.push([r.title,n,1,new Date(r.history.lastUpdated.when).getTime()]);a.length%100==0&&console.log(`Found ${a.length} pages`);var s=[];var c=r.children.page;for(;c&&c.size>0;){for(let t of c.results)s.push(e(t.id,r.title,a));c._links.next?(console.log(`Queueing GET next page of children for ${r.title}: ${c._links.next}`),c=await o(()=>$.ajax(c._links.next))):c=!1}await Promise.all(s)}(a.id,null,n),console.log(`*** Found ${n.length} pages total ***`),f(n)}function f(e){google.charts.load("current",{packages:["treemap"]}),google.charts.setOnLoadCallback(function(){console.log("DRAWING");var t=google.visualization.arrayToDataTable(e);tree=new google.visualization.TreeMap(document.getElementById("chart_div")),tree.draw(t,{minColor:"#f00",midColor:"#ddd",maxColor:"#0d0",headerHeight:15,fontColor:"black",showScale:!0,maxPostDepth:1,minColorValue:new Date("2016-01-01T00:00:00.000+00:00").getTime(),maxColorValue:new Date("2018-01-01T00:00:00.000+00:00").getTime(),useWeightedAverageForAggregation:!0})})}$.fn.confluence={movePages:async function(e,t,n,o){var i=await r(e,t);return await a(i.id,n,o)},movePagesById:a,updateContent:async function(e){return await $.ajax({url:"/rest/api/content/"+encodeURIComponent(e.id),type:"PUT",contentType:"application/json",data:JSON.stringify(e)})},createPageUnderPageId:p,createPage:l,copyPage:async function(e,t,n,o,a){var i=await r(e,t,"space,body.storage,metadata.labels");return a.transformPage(i),await l(i,n,o)},copyPageRecursive:async function(e,t,n,o,a,i){var c=r(e,t),l=r(n,o,"space"),p=await Promise.all(c,l);return await s(p[0].id,p[1].space.key,p[1].id,a,i)},searchPagesWithCQL:async function(e,t,n,o){(!n||n<0)&&(n=15);var a=o?"&expand="+encodeURIComponent(o):"";return await $.ajax("/rest/api/content/search?limit="+encodeURIComponent(n)+"&cql="+encodeURIComponent(t+" and type=page and space='"+e+"'")+a)},getContent:r,getContentById:i,dumpPageTree:u,chart:f},setTimeout(()=>u("ps","Projects France"),2e3)}});
//# sourceMappingURL=move-pages-bundle.js.map